<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividade do dia 05/08/2025</title>
    <style>

        body {
            background-color: gray;
            font-family: Arial, Helvetica, sans-serif;
        }

        h1,
        h2,
        h3 {
            font-family: 'Times New Roman', Times, serif;
            text-align: center;
        }

        p {
            text-align: center;
        }

        input  {
            background-color: rgb(152, 193, 226);
            border-radius: 5px;
        }

        button {
            border-radius: 5px;
            background-color: blue;
        }


    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>Atividade Complementar</h1>
        </div>
    </header>

    <main>
        <section id="boasVindas">
            <div class="treino">
                <div class="apresentacao">
                    <h2>
                        Seja Bem-Vindo!!!
                    </h2>
                    <p>
                        Desejo as boas vindas a todos. Essa página é especificamente para treinar conteudo repassado em aula.
                        Fique a seguir com alguns exemplos:
                    </p>
                </div>
                <div class="campos">
                    <h3>Criação de campos para cadastros</h3>
                    <input type="text" id="nome" placeholder="Digite seu Nome:">
                    <input type="text" id="dataNascimento" placeholder="Digite sua Data de Nascimento:">
                    <input type="email" id="email" placeholder="Digite seu E-Mail:">
                    <button onclick="realizarCadastro ()">Cadastrar</button>
                </div>
                <div class="tabela">
                    <h3>A seguir tentativa de criar uma tabela:</h3>
                    <table id="listaCadastros">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Data Nascimento</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>
    <script>

        let db;

        const request = indexedDB.open("CadastroDB", 1);

        request.onupgradeneeded = function (event) {
            const db = event.target.result; 

            if (!db.objectStoreNames.contains("cadastro")) {
                db.createObjectStore("cadastro", { keyPath: "id", autoIncrement: true });
            }
        };

        request.onsuccess = function (event) {
            db = event.target.result; // Armazena a referência ao banco de dados
             listarCadastros();
        };

        request.onerror = function () {
            console.error("Erro ao abrir o banco de dados.");
        };

        function realizarCadastro() {

            if (!db) {
                alert("Banco de dados não carregado ainda. Tente novamente.");
                return;
            }

            const nome = document.getElementById("nome").value.trim();
            const dataNascimento= document.getElementById("dataNascimento").value.trim();
            const email = document.getElementById("email").value.trim();

            if (!nome || !dataNascimento || !email) {
                alert("Preencha todos os campos!");
                return;
            }
            const transaction = db.transaction(["cadastro"], "readwrite");
            const store = transaction.objectStore("cadastro");

            const pessoa = { nome, dataNascimento, email };

            const request = store.add(pessoa);

            request.onsuccess = function () {
                listarCadastros();
                document.getElementById("nome").value = "";
                document.getElementById("dataNascimento").value = "";
                document.getElementById("email").value = "";
            };

            request.onerror = function () {
                alert("Erro ao cadastrar.");
            };
        }
        function listarCadastros() {
            
            if (!db) {
                console.warn("Banco de dados ainda não carregado.");
                return;
            }

            const transaction = db.transaction(["cadastro"], "readonly");
            const store = transaction.objectStore("cadastro");

            const request = store.getAll();

           
            request.onsuccess = function () {
                const tbody = document.querySelector("#listaCadastros tbody");
                tbody.innerHTML = ""; 

                request.result.forEach(pessoa => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${pessoa.nome}</td>
                            <td>${pessoa.dataNascimento}</td>
                            <td>${pessoa.email}</td>
                        </tr>`;
                });
            };
        }
    </script>
</body>
</html>